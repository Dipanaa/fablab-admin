@if(notificationStatusService.statusMessage()){
<status-message></status-message>
} @if(openEditView()) {
<modal-edit
  [fbEdit]="fbUser"
  (fbEditSend)="dataFormPut($event)"
  (closeModal)="openEditView.set($event)"
  [modalTitle]="'Editar usuario'"
></modal-edit>
} @if(openDeleteView()){
<modal-component
  [show]="openDeleteView()"
  [title]="'¿Esta seguro que desea eliminar este usuario?'"
  [description]="
    'El usuario perdera acceso al sistema y no podra ser partícipe de las funciones del laboratorio.'
  "
  (close)="openDeleteView.set(false)"
  (decline)="openDeleteView.set(false)"
  (accept)="deleteUser()"
></modal-component>
}

<div class="border-fablab-border flex flex-col gap-3">
  <div
    class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
  >
    <h1 class="text-3xl font-bold text-fablab-text-primary">
      Administración de Usuarios
    </h1>
    <div
      class="flex flex-col md:flex-row items-stretch md:items-center gap-3 w-full md:w-auto"
    >
      <searcher></searcher>
    </div>
  </div>
  <div
    class="h-auto w-full overflow-auto rounded-lg border border-fablab-border bg-fablab-card-bg"
  >
    <table class="min-w-full text-sm text-left text-fablab-text-secondary">
      <thead
        class="text-xs uppercase bg-fablab-text-secondary text-fablab-bg sticky top-0"
      >
        <tr>
          <th scope="col" class="px-4 py-3 font-bold">Nombre</th>
          <th scope="col" class="px-4 py-3 font-bold">Rut</th>
          <th scope="col" class="px-4 py-3 font-bold">Carrera</th>
          <th scope="col" class="px-4 py-3 font-bold">Rol</th>
          <th scope="col" class="px-4 py-3 font-bold">Proyectos</th>
          <th scope="col" class="px-4 py-3 font-bold">Acciones</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-fablab-border">
        @for (usuario of paginationService.pagedItems(); track
        usuario.id_usuario) {
        <tr class="hover:bg-fablab-border transition">
          <td class="px-4 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <img
                class="h-10 w-10 rounded-full"
                src="https://i.pravatar.cc/150?u={{ usuario.rut }}"
                alt="{{ usuario.nombre }}"
              />
              <div class="ml-3">
                <div class="font-medium text-fablab-text-primary">
                  {{ usuario.nombre }} {{ usuario.apellido }}
                </div>
                <div class="text-xs text-fablab-text-secondary">
                  {{ usuario.email || "sin_email@example.com" }}
                </div>
              </div>
            </div>
          </td>

          <td class="px-4 py-4 text-fablab-text-secondary">
            {{ usuario.rut }}
          </td>

          <td class="px-4 py-4 text-fablab-text-secondary">
            {{ usuario.carrera }}
          </td>

          <td class="px-4 py-4 text-fablab-text-secondary">
            {{ usuario.rol }}
          </td>

          <td class="px-4 py-4 text-fablab-text-secondary">
            <div class="max-h-10 overflow-y-auto">
              <ol class="list-decimal list-inside text-xs">
                @for (usuarios of usersService.usersData(); track $index) { @for
                (project of usuarios.proyectos_asignados; track $index) {
                <li>{{ project.titulo }}</li>
                } }
              </ol>
            </div>
          </td>
          <td class="px-4 py-4 text-fablab-text-secondary space-x-4">
            <button
              class="bg-fablab-accent text-black px-3 py-1 rounded hover:bg-fablab-accent-dark cursor-pointer"
              (click)="modalEditView(usuario.id_usuario)"
            >
              Editar
            </button>
            <button
              class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 cursor-pointer"
              (click)="modalDeleteView(usuario.id_usuario)"
            >
              Eliminar
            </button>
          </td>
        </tr>
        } @empty {
        <tr>
          <td
            colspan="6"
            class="text-center py-6 text-fablab-text-secondary bg-fablab-card-bg rounded-b-lg"
          >
            No se encontraron usuarios que coincidan con la búsqueda.
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <pagination
    [currentPage]="paginationService.currentPage()"
    [totalPages]="paginationService.totalPages()"
    (pageChange)="paginationService.goToPage($event)"
  />
</div>
