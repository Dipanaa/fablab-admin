<div class="border-slate-800 flex flex-col gap-3">
  <!-- Header -->
  <div
    class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
  >
    <h1 class="text-3xl font-bold text-white">Administración de Usuarios</h1>
    <!-- Controles: buscador + filtros -->
    <div
      class="flex flex-col md:flex-row items-stretch md:items-center gap-3 w-full md:w-auto"
    >
      <!-- Buscador -->
    </div>
  </div>
  <!-- Tabla -->
  <div class="h-auto w-full overflow-auto rounded-lg border border-slate-800">
    <table class="min-w-full text-sm text-left text-gray-300">
      <thead class="text-xs uppercase bg-slate-800 text-gray-400 sticky top-0">
        <tr>
          <th scope="col" class="px-4 py-3 font-bold">Nombre</th>
          <th scope="col" class="px-4 py-3 font-bold">Rut</th>
          <th scope="col" class="px-4 py-3 font-bold">Carrera</th>
          <th scope="col" class="px-4 py-3 font-bold">Rol</th>
          <th scope="col" class="px-4 py-3 font-bold">Proyectos</th>
          <th scope="col" class="px-4 py-3 font-bold">Acciones</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-800">
        @for (usuario of paginationService.pagedItems(); track
        usuario.id_usuario) {
        <tr class="hover:bg-slate-800/60 transition">
          <!-- Foto, nombre, correo -->
          <td class="px-4 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <img
                class="h-10 w-10 rounded-full"
                src="https://i.pravatar.cc/150?u={{ usuario.rut }}"
                alt="{{ usuario.nombre }}"
              />
              <div class="ml-3">
                <div class="font-medium text-white">{{ usuario.nombre }}</div>
                <div class="text-xs text-gray-400">
                  {{ usuario.email || "sin_email@example.com" }}
                </div>
              </div>
            </div>
          </td>

          <!-- Rut -->
          <td class="px-4 py-4 text-gray-400">{{ usuario.rut }}</td>

          <!-- Carrera -->
          <td class="px-4 py-4 text-gray-400">{{ usuario.carrera }}</td>

          <!-- Rol -->
          <td class="px-4 py-4 text-gray-400">{{ usuario.rol }}</td>

          <!-- Proyectos -->
          <td class="px-4 py-4 text-gray-400">
            <div class="max-h-10 overflow-y-auto">
              <ol class="list-decimal list-inside text-xs">
                @for (usuarios of usersService.usuariosData(); track $index) {
                @for (project of usuarios.proyectos_asignados; track $index) {
                <li>{{ project.title }}</li>
                } }
              </ol>
            </div>
          </td>
          <!-- Acciones -->
          <td class="px-4 py-4 text-gray-400 space-x-4">
            <button
              class="bg-indigo-600 text-gray-200 px-3 py-1 rounded hover:bg-indigo-700"
              (click)="modalEditView(usuario.id_usuario)"
            >
              Editar
            </button>
            <button
              class="bg-red-600 text-gray-200 px-3 py-1 rounded hover:bg-red-700"
              (click)="modalDeleteView()"
            >
              Eliminar
            </button>
          </td>
        </tr>
        } @empty {
        <tr>
          <td
            colspan="6"
            class="text-center py-6 text-gray-400 bg-slate-800 rounded-b-lg"
          >
            No se encontraron usuarios que coincidan con la búsqueda.
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <!-- Aqui conectamos el componente <pagination> con el paginationService
       enviando los 3 parametros que necesita y dejando activo el event a la espera de algun cambio-->
  <pagination
    [currentPage]="paginationService.currentPage()"
    [totalPages]="paginationService.totalPages()"
    (pageChange)="paginationService.goToPage($event)"
  />
</div>

@if(modalView()) {
<modal-edit
  [fbEdit]="fbUser"
  (fbEditSend)="dataForm($event)"
  (closeModal)="modalView.set($event)"
  [modalTitle]="'Editar usuario'"
></modal-edit>
}
