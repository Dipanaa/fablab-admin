<div class="border-slate-800 flex flex-col gap-6">
  <!-- Header -->
  <div
    class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
  >
    <h1 class="text-3xl font-bold text-white">Administración de usuarios</h1>

    <!-- Controles: buscador + filtros -->
    <div
      class="flex flex-col md:flex-row items-stretch md:items-center gap-3 w-full md:w-auto"
    >
      <!-- Buscador -->
      <div class="relative w-full md:w-72">
        <input
          type="text"
          placeholder="Buscar usuario..."
          #buscador
          (input)="usersService.buscarTermino.set(buscador.value)"
          [value]="usersService.buscarTermino()"
          class="w-full px-4 py-2 pl-10 bg-slate-800 text-gray-200 rounded-lg border border-slate-700 focus:ring-2 focus:ring-indigo-500 focus:outline-none shadow-sm"
        />
        <svg
          class="w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1110.5 3a7.5 7.5 0 016.15 13.65z"
          />
        </svg>
      </div>
    </div>
  </div>

  <!-- Tabla -->
  <div class="h-[410px] rounded-lg border border-slate-800">
    <table class="min-w-full text-sm text-left text-gray-300">
      <thead class="text-xs uppercase bg-slate-800 text-gray-400 sticky top-0">
        <tr>
          <th scope="col" class="px-4 py-3 font-medium">Nombre</th>
          <th scope="col" class="px-4 py-3 font-medium">Rut</th>
          <th scope="col" class="px-4 py-3 font-medium">Carrera</th>
          <th scope="col" class="px-4 py-3 font-medium">Rol</th>
          <th scope="col" class="px-4 py-3 font-medium">Proyectos</th>
          <th scope="col" class="px-4 py-3 font-medium">Acciones</th>
        </tr>
      </thead>

      <tbody class="divide-y divide-slate-800">
        @for (usuario of usuariosPaginados(); track usuario.nombre) {
        <tr class="hover:bg-slate-800/60 transition">
          <!-- Foto, nombre, correo -->
          <td class="px-4 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <img
                class="h-10 w-10 rounded-full"
                src="https://i.pravatar.cc/150?u={{ usuario.rut }}"
                alt="{{ usuario.nombre }}"
              />
              <div class="ml-3">
                <div class="font-medium text-white">{{ usuario.nombre }}</div>
                <div class="text-xs text-gray-400">
                  {{ usuario.email || "sin_email@example.com" }}
                </div>
              </div>
            </div>
          </td>

          <!-- Rut -->
          <td class="px-4 py-4 text-gray-400">{{ usuario.rut }}</td>

          <!-- Carrera -->
          <td class="px-4 py-4 text-gray-400">{{ usuario.carrera }}</td>

          <!-- Rol -->
          <td class="px-4 py-4 text-gray-400">{{ usuario.rol }}</td>

          <!-- Proyectos -->
          <td class="px-4 py-4 text-gray-400">
            <div class="max-h-10 overflow-y-auto">
              <ol class="list-decimal list-inside text-xs">
                @for (usuarios of usersService.usuariosData(); track $index) {
                @for (project of usuarios.proyectos_asignados; track $index) {
                <li>{{ project.title }}</li>
                } }
              </ol>
            </div>
          </td>

          <!-- Acciones -->
          <td class="px-4 py-4 text-sm font-medium">
            <a
              (click)="editarUsuario(usuario.id_usuario)"
              class="text-indigo-400 hover:text-indigo-300 cursor-pointer"
              >Editar</a
            >
            <a
              (click)="eliminarUsuario(usuario.id_usuario)"
              class="ml-3 text-red-400 hover:text-red-300 cursor-pointer"
              >Eliminar</a
            >
          </td>
        </tr>
        } @empty {
        <tr>
          <td
            colspan="6"
            class="text-center py-6 text-gray-400 bg-slate-800 rounded-b-lg"
          >
            No se encontraron usuarios que coincidan con la búsqueda.
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <div class="flex items-center justify-center gap-6 text-gray-400">
    <button
      (click)="irAPagina(paginaActual() - 1)"
      [disabled]="paginaActual() === 1"
      class="p-2 rounded-lg border border-slate-700 hover:bg-slate-800 disabled:opacity-50"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="size-6"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M15.75 19.5 8.25 12l7.5-7.5"
        />
      </svg>
    </button>

    <p>
      Página <strong class="text-white">{{ paginaActual() }}</strong> de
      <strong class="text-white">{{ totalPages() }}</strong>
    </p>

    <button
      (click)="irAPagina(paginaActual() + 1)"
      [disabled]="paginaActual() === totalPages()"
      class="p-2 rounded-lg border border-slate-700 hover:bg-slate-800 disabled:opacity-50"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="size-6"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="m8.25 4.5 7.5 7.5-7.5 7.5"
        />
      </svg>
    </button>
  </div>
</div>
