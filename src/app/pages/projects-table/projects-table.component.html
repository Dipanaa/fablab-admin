@if(notificationStatusService.statusMessage()){
<div class="fixed mb-2 mr-2 right-0 bottom-0 z-10">
  <status-message></status-message>
</div>
} @if(openDeleteView()){
<modal-component
  [show]="openDeleteView()"
  [title]="'¿Esta seguro que desea eliminar este proyecto?'"
  [description]="
    'El o los usuarios participes del proyecto ya no tendran mas acceso a el'
  "
  (close)="openDeleteView.set(false)"
  (decline)="openDeleteView.set(false)"
  (accept)="deleteProject()"
  [loading]="loading()"
></modal-component>
}

<div class="border-fablab-border flex flex-col gap-3">
  <div
    class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
  >
    <h1 class="text-3xl font-bold text-fablab-text-primary">
      Administración de Proyectos
    </h1>
    <div
      class="flex flex-col md:flex-row items-stretch md:items-center gap-3 w-full md:w-auto"
    >
      <searcher
        (search)="onSearch($event)"
        [searchTerm]="searchTerm()"
      ></searcher>
    </div>
  </div>

  <div
    class="h-auto w-full overflow-auto rounded-lg border border-fablab-border bg-fablab-text-secondary"
  >
    <table class="min-w-full text-sm text-left text-fablab-text-secondary h-full overflow-hidden">
      <thead
        class="text-xs uppercase bg-fablab-text-secondary text-fablab-bg sticky top-0"
      >
        <tr>
          <th class="px-6 py-3 font-bold">Proyecto</th>
          <th class="px-6 py-3 font-bold">Descripción</th>
          <th class="px-6 py-3 font-bold">Categoría</th>
          <th class="px-6 py-3 font-bold">Area de aplicacion</th>
          <th class="px-6 py-3 font-bold">Destacar</th>
          <th class="px-6 py-3 font-bold">Acciones</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-fablab-border bg-fablab-card-bg">
        @for (proyecto of paginationService.pagedItems(); track proyecto.id; let
        i = $index) {
        <tr
          class="bg-fablab-card-bg hover:bg-fablab-border transition animate__animated animate__fadeInUp animate__fast"
          [style.animationDelay]="i * 0.1 + 's'"
        >
          <td class="px-2 py-4">
            <div class="flex items-center h-16">
              <img
                class="h-12 w-12 rounded object-cover border border-fablab-border"
                [src]="proyecto.imgurl"
                alt="Imagen del proyecto"
              />
              <div class="ml-4 max-w[12rem] min-w-30">
                <div
                  class="text-sm font-medium text-fablab-text-primary"
                  title="{{ proyecto.titulo }}"
                >
                  {{ proyecto.titulo }}
                </div>
                <div
                  class="text-sm font-medium text-fablab-text-secondary line-clamp-2"
                  title="{{ proyecto.titulo }}"
                >
                  {{ proyecto.fechainicio | date }}
                </div>
              </div>
            </div>
          </td>

          <td class="px-2 py-4 align-top">
            <div
              class="max-h-14 max-w-80 overflow-y-auto text-sm text-fablab-text-secondary pr-2"
            >
              {{ proyecto.descripcionproyecto }}
            </div>
          </td>

          <td class="px-2 py-4 text-fablab-text-secondary">
            <span
              class="text-fablab-primary text-xs font-semibold px-2 py-1 border-fablab-primary/30"
            >
              {{ proyecto.categoria }}
            </span>
          </td>

          <td class="px-2 py-4 text-fablab-text-secondary">
            <span
              class="text-fablab-primary text-xs font-semibold px-2 py-1 border-fablab-primary/30"
            >
              {{ proyecto.areaaplicacion }}
            </span>
          </td>
          <td class="px-0 py-0 text-center">
            <div class="inline-flex items-center">
              <label class="flex items-center cursor-pointer relative">
                <input
                  type="checkbox"
                  class="peer h-5 w-5 cursor-pointer transition-all appearance-none rounded shadow hover:shadow-md border border-fablab-text-secondary checked:bg-fablab-primary checked:border-fablab-primary"
                  id="check"
                />

                <span
                  class="absolute bg-fablab-accent text-black border rounded border-fablab-text-primary opacity-0 peer-checked:opacity-100 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4.5 w-4.5"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                    stroke="currentColor"
                    stroke-width="1"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                </span>
              </label>
            </div>
          </td>

          <td class="px-2 py-4 whitespace-nowrap text-sm font-medium space-x-3">
            <button
              [routerLink]="['/proyectos/edit-project', proyecto.id]"
              class="bg-fablab-accent text-black px-3 py-1 rounded hover:bg-fablab-accent-dark cursor-pointer"
            >
              Editar
            </button>
            <a
              (click)="modalDeleteView(proyecto.id)"
              class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 cursor-pointer"
            >
              Eliminar
            </a>
          </td>
        </tr>
        } @empty {
        <tr class="bg-fablab-card-bg">
          <td colspan="6" class="text-center py-6 text-fablab-text-secondary">
            No se encontraron proyectos.
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <pagination
    [currentPage]="paginationService.currentPage()"
    [totalPages]="paginationService.totalPages()"
    (pageChange)="paginationService.goToPage($event)"
  />
</div>
